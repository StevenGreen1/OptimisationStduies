#!/bin/bash

#===== Batch calibration for optimisation studies =====#

#===================================#
#===== Detector Model Settings =====#
numberOfHCalLayers[38]="48"
numberOfHCalLayers[39]="48"
numberOfHCalLayers[40]="48"
numberOfHCalLayers[41]="48"
numberOfHCalLayers[42]="48"
numberOfHCalLayers[43]="48"
numberOfHCalLayers[44]="48"
numberOfHCalLayers[45]="48"
numberOfHCalLayers[46]="48"
numberOfHCalLayers[47]="48"
numberOfHCalLayers[48]="48"
numberOfHCalLayers[49]="18"
numberOfHCalLayers[50]="24"
numberOfHCalLayers[51]="30"
numberOfHCalLayers[52]="36"
numberOfHCalLayers[53]="42"
numberOfHCalLayers[54]="54"
numberOfHCalLayers[55]="60"
numberOfHCalLayers[56]="48"
numberOfHCalLayers[57]="48"
numberOfHCalLayers[58]="48"
numberOfHCalLayers[59]="48"
numberOfHCalLayers[60]="48"
numberOfHCalLayers[61]="48"
numberOfHCalLayers[62]="48"
numberOfHCalLayers[63]="48"
numberOfHCalLayers[64]="48"
numberOfHCalLayers[65]="48"
numberOfHCalLayers[66]="48"
numberOfHCalLayers[67]="48"
numberOfHCalLayers[68]="48"
numberOfHCalLayers[69]="48"
numberOfHCalLayers[70]="48"
numberOfHCalLayers[71]="48"
numberOfHCalLayers[72]="48"
numberOfHCalLayers[73]="48"
numberOfHCalLayers[74]="48"
numberOfHCalLayers[75]="48"
numberOfHCalLayers[76]="48"
numberOfHCalLayers[77]="48"
numberOfHCalLayers[78]="48"
numberOfHCalLayers[79]="48"
numberOfHCalLayers[80]="48"
numberOfHCalLayers[81]="48"
numberOfHCalLayers[82]="48"
numberOfHCalLayers[83]="48"
numberOfHCalLayers[84]="48"
numberOfHCalLayers[85]="48"
numberOfHCalLayers[86]="48"
numberOfHCalLayers[87]="48"
numberOfHCalLayers[88]="48"
numberOfHCalLayers[89]="48"
numberOfHCalLayers[90]="48"
numberOfHCalLayers[91]="48"
numberOfHCalLayers[92]="48"
numberOfHCalLayers[93]="48"
numberOfHCalLayers[94]="48"
numberOfHCalLayers[95]="48"

ecalRealisticDigi[38]="1"
ecalRealisticDigi[39]="1"
ecalRealisticDigi[40]="1"
ecalRealisticDigi[41]="1"
ecalRealisticDigi[42]="1"
ecalRealisticDigi[43]="1"
ecalRealisticDigi[44]="1"
ecalRealisticDigi[45]="1"
ecalRealisticDigi[46]="1"
ecalRealisticDigi[47]="1"
ecalRealisticDigi[48]="1"
ecalRealisticDigi[49]="1"
ecalRealisticDigi[50]="1"
ecalRealisticDigi[51]="1"
ecalRealisticDigi[52]="1"
ecalRealisticDigi[53]="1"
ecalRealisticDigi[54]="1"
ecalRealisticDigi[55]="1"
ecalRealisticDigi[56]="1"
ecalRealisticDigi[57]="1"
ecalRealisticDigi[58]="1"
ecalRealisticDigi[59]="1"
ecalRealisticDigi[60]="1"
ecalRealisticDigi[61]="1"
ecalRealisticDigi[62]="1"
ecalRealisticDigi[63]="1"
ecalRealisticDigi[64]="1"
ecalRealisticDigi[65]="1"
ecalRealisticDigi[66]="1"
ecalRealisticDigi[67]="1"
ecalRealisticDigi[68]="1"
ecalRealisticDigi[69]="1"
ecalRealisticDigi[70]="1"
ecalRealisticDigi[71]="1"
ecalRealisticDigi[72]="1"
ecalRealisticDigi[73]="1"
ecalRealisticDigi[74]="1"
ecalRealisticDigi[75]="1"
ecalRealisticDigi[76]="1"
ecalRealisticDigi[77]="1"
ecalRealisticDigi[78]="1"
ecalRealisticDigi[79]="1"
ecalRealisticDigi[80]="1"
ecalRealisticDigi[81]="1"
ecalRealisticDigi[82]="1"
ecalRealisticDigi[83]="1"
ecalRealisticDigi[84]="1"
ecalRealisticDigi[85]="1"
ecalRealisticDigi[86]="1"
ecalRealisticDigi[87]="1"
ecalRealisticDigi[88]="1"
ecalRealisticDigi[89]="1"
ecalRealisticDigi[90]="2"
ecalRealisticDigi[91]="2"
ecalRealisticDigi[92]="2"
ecalRealisticDigi[93]="2"
ecalRealisticDigi[94]="2"
ecalRealisticDigi[95]="2"

#===== Reconstruction Settings =====#
MHHHE[69]="0.5"
MHHHE[70]="0.75"
MHHHE[71]="1.0"
MHHHE[72]="1.5"
MHHHE[73]="2.0"
MHHHE[74]="5.0"
MHHHE[75]="10.0"
MHHHE[76]="1000000.0"

ECalBarrelTimeWindowMax="100.0"
HCalBarrelTimeWindowMax="100.0"
ECalEndcapTimeWindowMax="100.0"
HCalEndcapTimeWindowMax="100.0"

#===== End Settings =====#

for detModel in {84..95}
do
    slcioPath="/r04/lc/sg568/HCAL_Optimisation_Studies/Slcio/GJN${detModel}/"
    gearFile="/r04/lc/sg568/HCAL_Optimisation_Studies/GridSandboxes/GJN${detModel}_OutputSandbox/ILD_o1_v06_GJN${detModel}.gear"
    pandoraSettingsFile="/usera/sg568/ilcsoft_v01_17_07/OptimisationStudies/Calibration/PandoraSettings_MarlinPandora_v02-00-00/PandoraSettingsDefault.xml" 
    currentNumberOfHCalLayers=${numberOfHCalLayers[${detModel}]}
    currentECalRealisticDigi=${ecalRealisticDigi[${detModel}]}
    slcioFormat="ILD_o1_v06_GJN${detModel}_ENERGY_GeV_Energy_PARTICLE_pdg_SN_(.*?).slcio"
    for recoStage in {69..76}
    do
        calibrationResultsPath="/r04/lc/sg568/HCAL_Optimisation_Studies/CalibrationResults/Detector_Model_${detModel}/Reco_Stage_${recoStage}/"
        currentMHHHE="${MHHHE[${recoStage}]}"
        cd /usera/sg568/ilcsoft_v01_17_07/OptimisationStudies/Calibration/MyCalibration
        ./Calibrate.sh "${slcioPath}" "${slcioFormat}" "${gearFile}" "${calibrationResultsPath}" "${pandoraSettingsFile}" "${currentMHHHE}" "${currentNumberOfHCalLayers}" "${currentECalRealisticDigi}" "${ECalBarrelTimeWindowMax}" "${HCalBarrelTimeWindowMax}" "${ECalEndcapTimeWindowMax}" "${HCalEndcapTimeWindowMax}"
    done
done

